

# 鉴别与认证
- 身份鉴别-你是谁，从诸多可能的对象列表中识别出主体（1对多）
- 认证-你是你所声称的那个人吗(1对1)


## 认证
- 你知道什么：口令 （成本最低）
- 你具有什么：智能卡
- 你是谁：指纹

### 口令
口令+salt，使同一个明文有不同的摘要值，防止前向检索攻击(有人事先算好字典，再比较)。添加salt值的计算与不添加是一样的，salt可以明文，

### 生物特征
理想的生物特征技术应满足以下要素：
- 通用性： 适用于每一个人。实际上，没有哪个生物特征能够应用于所有人，例如，存在少部分的人不具有可读取的指纹。
- 可分辨性：现实中，不能期望100%确定性。
- 永久性：可测量的物理特征应该永久不变，实践中，能够在相当长的一段时间内保持稳定就足够了。
- 可采集性：容易采集，且对认证的主体不会带来任何潜在的伤害。实际上，可采集性往往严重依赖主体是否愿意合作。
- 可靠性、鲁棒性、用户友好性

生物特征的注册过程比较缓慢并需要多次测量，并且在某些现场系统中，采集的结果与在实验室条件下得到的样本很难具有可比性。

- 错误接受率：bob冒充alice，系统错误地将bob认证为alice。
- 错误拒绝率：alice尝试认证她自己，但没有通过。
- 等错误率：对系统参数进行调整，使错误接受率和错误拒绝率能够达到一种恰好平衡的水平。

# 授权
## 橘皮书
《可信计算机系统评估准则》，The Trusted Computing System Evaluation Criteria，又称橘皮书，对安全产品分为4个不同层次：
- D 最小保护：为了对应那些不能够满足更高级别要求的系统。
- C 自主保护： 用户可能会破坏安全性，但是他们的行为可以被捕获。
   - C1 自主安全保护：系统必须提供“能够针对单个人层面施加访问限制的可信赖的控制能力”。
   - C2 受控访问保护：比C1级别中的系统施加更为细粒度的自主访问控制。
- B 强制保护：保护是强制的，用户不能破坏安全性，即使他们想要尝试。
   - B1 标签安全保护：强制访问控制是基于指定标签的。也就是说，所有的数据都携带某些类型的标签，这些标签决定了哪些用户可以访问相应的数据，可以对相应的数据执行什么样的操作。
   - B2 结构化保护：在B1级别上，这个级别增加了隐藏通道保护和少量其他技术特性。
   - B3 安全域：在B2级别之上，实现安全特性的代码必须是“能够防篡改，并且足够小以应对分析和测试”
- A 验证保护：这个层次的要求与B3级别基本相同，除了必须能够有效地运用所谓的形式化方法来证明系统达到了其所声称的安全性。

## CC
如今橘皮书在形式上已经被通用准则Common Criteria所取代。CC认证输出评估保证级别Evaluation Assurance Level，7个级别：
- EAL1-功能测试
- EAL2-结构测试
- EAL3-系统地测试和检查
- EAL4-系统地设计、测试和复查
- EAL5-半形式化地设计和测试
- EAL6-半形式化地验证设计和测试
- EAL7-形式化地验证设计和测试

要想获得EAL7级认证，必须提供安全性的形式化证明，且安全专家们要对产品进行仔细的分析。对于最低级别EAL认证，需要分析的就只是文档而已。最广受欢迎的是EAL4，因为这一般是可以销售给政府的最低要求了。

## 访问控制矩阵（Lampson）
访问控制列表ACL和访问能力列表C-list都源自Lampson的访问控制矩阵。主体S对于客体O的访问许可情况就存储在矩阵中以S为索引的行，与O为索引的列相交的位置上。
![](pic/访问控制矩阵.png)

记账程序既可以看成一个客体，又被当作主体，这样我们就可以强制施加限定条件，使得财务数据仅能由记账程序来修改。

一个系统可能有多个主体以及数万个客体，导致访问控制矩阵记录太多。在执行任何一个主体对客体的操作之前，都需要查阅，处理如此巨大的矩阵会给系统施加显著的负担。

为了在授权操作上获得可接受的性能，有2种直观方式来分割访问控制矩阵：
1. 按列分割，每一列与其对应的客体存储在一起（对客体的控制）。这些列称为`访问控制列表ACL`.
2. 按行分割，每一行与其对应的主体存储在一起（主体的能力），这种方案称为`访问能力列表C-list`。
![](pic/访问控制列表.png)

访问能力列表，用户和文件之间的关联是内建在系统之中的。访问控制列表，需要有单独的方式来建立用户和文件之间的关联关系。

### 混淆代理人
![](pic/混淆代理人.png)
两个资源对象：编译程序、BILL文件。一个用户：Alice。编译程序对所有文件可以执行写操作。Alice可以触发编译程序，并在编译程序写调试信息时指定文件名。不允许Alice对BILL执行写操作。

假设Alice触发编译程序，并想要输出调试信息的文件名为BILL。因为Alice没有权限，这个应该失败，但是编译程序有权限，入根编译程序以它的权限行事，会毁坏BILL。也就是说，编译程序发生了混淆，因为它应该基于Alice的权限工作。

基于访问能力列表比较容易防止这类问题：Alice触发编译程序时，可以将自己的访问能力列表授权给编译程序，于是编译程序在试图创建调试文件时，要先引用Alice的访问能力列表查看权限。

### 访问控制列表vs访问能力列表
- 当用户想要管理自己的文件，并且保护是面向数据的情况下，访问控制列表是更好的选择。
- 访问能力列表容易实现授权机制，以及二级授权、三级授权，且容易实现增加和删除用户。
- 访问能力列表通常实现复杂，且系统符合高，分布式系统中很多难题都是源自这种访问能力列表。因此，访问控制列表在实践中的应用要多。


## 多级安全性Multilevel Security
在大部分的公司业务管理中，都有一类信息是受严格限制（供高级管理层），而另外一些信息则是供全体管理层访问，同时还有信息共享给所有人。如果这些信息被存储在单一系统中，那么公司必须要解决多级安全性问题。

美国国防部定义4级： TOP SECRET>SECRET>CONFIDENTIAL>UNCLASSIFIED
主体S的安全等级表示为L(S)，客体O的安全等级表示为L(O)。

### Bell-LaPadula模型-针对机密性
- 简单安全条件：
不许向上读：主体S能够对客体O执行读操作，当且仅当L(O)<=L(S)。Alice不能够读取一个文档，如果她缺乏相应的权限。

- 星特性：
不许向下写：主体S能够对客体O执行写操作，当且仅当L(S)<=L(O)。要防止Top secret级别的信息被写入secret级别的文档。

### Biba-针对完整性
客体O的完整性等级是所有包含于O中客体完整性等级最小值。
- 写访问原则：主体S能对客体O执行写操作，当且仅当I(O)<=I(S)。我们对主体所写的内容的新人程度，不会超过我们对S自身的信任程度。
- Biba模型：主体S能对客体O执行读操作，当且仅当I(s)<=I(o)。我们对主体S的信任不应超过S所读取的客体的最低完整性级别。本质上说，我们的顾虑是S将被更低完整性级别的客体“弄脏”，所以要禁止S查看这样的客体。
- 低水印策略：如果主体S对客体O执行了读，那么I(s)=min(I(s),I(o)).

![](pic/BLP.png)


## 分隔项 compartment
使用分隔项来进一步限定信息流所“跨越”的安全级别。分隔项主要是用于强化必须知情原则，也就是说，只有当主体因工作需要必须了解某个信息时，才能允许其访问。

例如：分隔项 TOP SECRET{CAT}和TOP SECRET{DOG}。虽然都是TOP SECRET级别，但是一个具有TOP SECRET级别的主体只有在经过特殊许可的情况下，才能对分隔项进行访问。

## 隐藏通道
隐藏通道的成立，要有3个条件：
- 发送方和接受方有一个共享的资源。
- 发送方必须能以接受方能察觉到的方式改变共享资源的某些属性。
- 发送方和接受方能实现通信的同步。

在任何一个有用的系统中，想要消除掉所有的隐藏通道实际上时不可能的。

例子：
TCP协议头，包含一个预留的字段以供未来的用途，可以被用于秘密地传递信息。

## CAPTCHA
completely automated public Turing test to tell computers and humans apart,完全自动化的公开的图灵测试，其目标是将计算机和人区别开来，

CAPTCHA的设计目标就是防止非自然人访问资源对象，也可以视作一种访问控制的形式。免费邮件系统服务使用CAPTCHA来防止垃圾邮件发送者为大量的电子邮件账户进行自动订阅。

## 防火墙
简单的防火墙只过滤一些明显的伪造请求。

### 端口扫描攻击
- TCP ACK扫描--
攻击者构造一个数据包，并设置ACK位，从而跳过TCP三次握手的前2个步骤。由于包过滤防火墙没有状态的概念，会认为这个包是某个已经建立的连接的一部分，于是，只要该数据包发往一个开放的端口，防火墙就会让其通行。主机发现这个数据包不是已经建立连接的一部分，响应一个RST包。

- Firewalk检测工具--
存活生命期TTL是IP数据包头的一个字段，包含了数据包在终止之前可以被转发的跳数。如果攻击者知道防火墙IP、内部网络上某个系统的IP，还知道从该系统到防火墙的跳数，那么，她可以向内部网络IP上发数据包，TTL设置为比到防火墙的跳数大1，假如防火墙让数据包在端口p上通行，攻击者会受到超时错误。


### 包过滤防火墙
在网络层上对数据包进行检查。根据在网络层可用的信息进行数据包的过滤，包括源IP地址、目的IP地址、源端口、目的端口、TCP标志位。能够对进入的数据包和发出的数据包分别指定不同的过滤规则。

- 包过滤防火墙的主要优势是性能好，仅仅处理网络层，也只有包头信息会被检查。
- 没有状态的概念，每个数据包的处理是独立的，也就是对应用数据是没有感知的。
- 使用访问控制列表ACL进行配置。
![](pic/防火墙.png)


### 基于状态检测的包过滤防火墙
在普通包过滤防火墙的基础上增加状态管理，能够跟踪TCP连接，并且能记忆UDP连接。从概念上讲，基于状态检测的包过滤防火墙工作在传输层。

可以防止TCP ACK攻击。不足是不能检查应用数据。

### 应用代理防火墙
对数据包一路分析到应用层。应用代理有能力在应用层过滤掉恶意数据（比如病毒），同时也能够在传输层过滤掉恶意的数据。

应用代理在数据包通过防火墙时，会毁弃进来的数据包并在同样的位置创建一个新的数据包。应用代理可以阻止Firewalk。

### 深度防御的例子
![](pic/深度防御.png)

- 包过滤防火墙被置于停火区（DMZ），用于防御对系统的常规性攻击。置于DMZ区的部分都是一些必须暴露给外部的应用，要接收来自外部的大部分流量，从性能考虑，使用简单的包过滤防火墙。
- 一台应用代理防火墙部署在内部网络和DMZ之间，为内部网络提供了最大可能性的防火墙保护措施。进入到内部网络的流量相对比较小，所以部署一台应用代理不会构成瓶颈。
- 最后一层防护，个人防火墙可以被部署在公司内部网络中的特定主机上。

## 入侵检测系统 Instrusion detection System
计算机安全的主要认为是入侵防御，但是当防御失败时，需要检测系统，在攻击发生之前、期间、之后，检测出这些攻击。

IDS的基本方法时查看“异常”活动，自动化入侵检测实际上时人工日志文件分析的发展。

入侵响应：一旦检测有入侵，就要做成响应。比如检测到针对某个特定账户的口令猜测攻击，可以锁定该账户来做出响应。
### 方法
- 基于特征的IDS：基于明确的已知特征来检测。例如：“M秒种之内发生N次登录尝试失败”定义为攻击的一个特征。
  - 优势是简单、高效，以及优秀的检测已知攻击的能力，能发出明确的报警。
  - 劣势是特征文件必须足够新，特征数量太多会造成性能下降。只能检测已知类型的攻击。已知攻击的轻微变体可能会被错过。

- 基于异常的IDS：先给系统的正常行为一个基线，当系统行为与基线偏差过大，IDS报警。
  - 首先要确定对于系统来说，正常的行为都包括什么。
  - 其次，随着系统使用方法的变化和系统自身的演化，这些正常行为的定义必须做调整
  - 统计门限的设定
  - 异常行为引发的报警可能提供不了对管理员有用的具体信息。
  - 优势是有可能检测出之前不知道的攻击。

### 架构
- 基于主机的IDS：入侵检测的方法应用于发生在主机上的活动中，对于主机上可见的攻击（缓冲区溢出攻击、权限提升类攻击）的检测有优势。
- 基于网络的IDS：应用在网络流量上，类似拒绝服务攻击、端口扫描、涉及畸形数据包的检测。与防火墙的功能有所重叠。

# 零知识证明
公钥技术的运用使得参与者难以保持匿名的身份。零知识证明的一个优势是允许以匿名的方式进行身份认证。

## Bob洞穴问题
Alice声称她知道秘密的暗语，能够打开R和S之间的那扇门。Alice怎么说服Bob相信她知道这个秘密暗语，又不会泄露相关信息。

![](pic/洞穴问题.png)
Alice进入洞穴，抛硬币决定去R或是S点，假设Alice到了R点，然后Bob进入洞穴到Q点。Bob抛硬币决定让Alice从哪里出现。如果Bob碰巧也是R，则Alice无论是否知道谜语，都可以出现。如果Bob选择了S，那么Alice必须知道开门暗语才能出现在S侧。也就是说，如果Alice不知道暗语，那么骗过Bob的概率是0.5。如果重复n次，例如20次，那么这个概率会小于1000000分之一。这里最关键的是，Bob随机选择其中一侧。

## Fiat-Shamir协议
数学依赖：求解模N的平方根，其难度与因式分解相当。假设N=pq，其中p和q都是素数。Alice知道一个秘密S。`N 和 v=S^2 mod N 公开`(从N和v计算出S很难)。Alice说服bob相信她知道S。
![](pic/Fiat-Shamir.png)
第二条消息，如果bob发送e=1,则Alice必须知道S。如果e=0，则Alice不必知道S。

第1条消息属于提交阶段，Alice发送给Bob的r值的选择。也就是说Alice不能改变主意，另外也没有泄露r值，因为求模平方根的运算很困难。
第2条消息是challenge，即Bob要求Alice提供正确的响应。
第3条消息是response。

如果攻击者能预测到e=1，那么可以在第1条消息发x = r^2 v^-1 mod N，第3条发y=r mod N。而Bob会发现等式9.1成立。所以要随机发e=0,1。经过n次迭代，攻击者瞒天过海的概率0.5^n。

另外，Alice必须每次都随机生成r，否则S会被泄露。