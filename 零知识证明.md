# 零知识证明(Zero—Knowledge Proof)
零知识证明的一个优势是允许以匿名的方式进行身份认证。

零知识证明并不是数学意义上的证明，因为它存在小概率的误差，欺骗者有可能通过虚假陈述骗过证明者。换句话来说，零知识证明是概率证明而不是确定性证明。但是也存在有技术能将误差降低到可以忽略的值。

零知识的形式定义必须使用一些计算模型，最常见的是图灵机的计算模型。

例子：
有一个缺口环形的长廊，出口和入口距离非常近（在目距之内），但走廊中间某处有一道只能用钥匙打开的门，A要向B证明自己拥有该门的钥匙。采用零知识证明，则B看着A从入口进入走廊，然后又从出口走出走廊，这时B没有得到任何关于这个钥匙的信息，但是完全可以证明A拥有钥匙

## 零知识证明一般的过程
假设有两方人，甲方是证明者，乙方是验证者。他们在一个工作环境内有相同的一组函数和一组数值。证明开始：

1. 甲方先发送满足条件的随机值给乙方，这个称为承诺。 
2. 乙方发送满足条件的随机值给甲方，这个称为挑战。 
3. 甲方执行一个不让乙方知道的计算，并把计算结果给乙方，这个称为响应。 
4. 乙方对响应进行验证，验证失败就退出，验证成功回到1，然后继续顺序执行n次。 

如果每一次乙方验证都是成功的，那么乙方就相信了和甲方之间的共识。在整个过程中没有透露任何相关秘密信息。 


## Bob洞穴问题
Alice声称她知道秘密的暗语，能够打开R和S之间的那扇门。Alice怎么说服Bob相信她知道这个秘密暗语，又不会泄露相关信息。

![](pic/洞穴问题.png)
Alice进入洞穴，抛硬币决定去R或是S点，假设Alice到了R点，然后Bob进入洞穴到Q点。Bob抛硬币决定让Alice从哪里出现。如果Bob碰巧也是R，则Alice无论是否知道谜语，都可以出现。如果Bob选择了S，那么Alice必须知道开门暗语才能出现在S侧。也就是说，如果Alice不知道暗语，那么骗过Bob的概率是0.5。如果重复n次，例如20次，那么这个概率会小于1000000分之一。最关键的是，Bob随机选择其中一侧。

## Fiat-Shamir协议
数学依赖：求解模N的平方根，其难度与因式分解相当。

假设N=pq，其中p和q都是素数。Alice知道一个秘密S。`N 和 v=S^2 mod N 公开`(从N和v计算出S很难)。Alice说服bob相信她知道S。
![](pic/Fiat-Shamir.png)
第二条消息，如果bob发送e=1,则Alice必须知道S。如果e=0，则Alice不必知道S。

第1条消息属于提交阶段，Alice发送给Bob的r值的选择。也就是说Alice不能改变主意，另外也没有泄露r值，因为求模平方根的运算很困难。
第2条消息是challenge，即Bob要求Alice提供正确的响应。
第3条消息是response。

如果攻击者能预测到e=1，那么可以在第1条消息发x = r^2 v^-1 mod N，第3条发y=r mod N。而Bob会发现等式9.1成立。所以要随机发e=0,1。经过n次迭代，攻击者瞒天过海的概率0.5^n。

另外，Alice必须每次都随机生成r，否则S会被泄露。

# zk-SNARKs（Zero-Knowledge Succinct Non-Interactive Argument ofKnowledge）

Computation → Arithmetic Circuit → R1CS → QAP → zk-SNARK

1. 将交易有效性函数转换为数学表示的第一步，是将逻辑步骤分解为最小的操作，从而创建“运算电路”(Arithmetic Circuit)。 类似于布尔电路，其中程序被编译为离散的单个步骤，如AND，OR，NOT；而当程序转换为运算电路时，它被分解为单个步骤，包括加法，减法以及乘法和除法的基本算术运算（不过，在特定情况下，我们将避免使用除法）。

# ZCash
Alice要向Bob转一个单位的数字货币（BTC/ZEC），即Alice要向Bob转移一个单位的资产所有权。这时有以下两个方法：

（一）比特币中的做法：Alice拥有一张1BTC的支票，要转账给Bob时，先给Bob新建一张1BTC的支票，同时当着Bob的面将自己原先的支票撕毁。

（二）ZCash中的做法：Alice拥有一张1ZEC的支票，要转账给Bob时，先给Bob新建一张1ZEC的支票，然后在一张约定有效的作废列表中，记录下Alice的发票的代号，证明Alice的支票已经失效。

为了隐藏交易者信息，要对两张支票进行加密处理。信息都是被加密的，可以通过拥有者的私钥解密

ZCash的方法属于零知识证明。整个交易过程中，Bob并没有见过Alice的支票，但是还是实现了资产所有权的转移。在ZCash的整个交易系统中，Alice和Bob的交易还有其他见证者，即负责记录交易信息的矿工。同样道理，矿工也不必看到Alice的支票，只要能确定代号为r1的支票已经作废了就行。



矿工拿到Alice给的支票代号r1，去作废列表中检索，假如作废列表中已经存在r1，则证明r1所对应的的支票早已失效；若作废列表中并不存在r1，则证明r1对应的支票仍旧有效，此时矿工把r1录入作废列表中，把新生成的支票录入支票列表中。

每笔交易矿工能接收到的东西只有一个发票代号，和一张新的发票，而且这两样东西都是被加密的。所以矿工并不知道转账双方是谁，也不知道转账金额是多少。
